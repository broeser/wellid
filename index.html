<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>wellid by broeser</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>wellid</h1>
          <h2>A set of PHP validators.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/broeser/wellid/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/broeser/wellid/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/broeser/wellid" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="wellid" class="anchor" href="#wellid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>wellid</h1>

<p>wellid is a set of PHP validators and a few loosely coupled components for validation.</p>

<p><a href="https://travis-ci.org/broeser/wellid"><img src="https://travis-ci.org/broeser/wellid.svg?branch=master" alt="Build Status"></a>
<a href="https://codecov.io/github/broeser/wellid?branch=master"><img src="https://codecov.io/github/broeser/wellid/coverage.svg?branch=master" alt="codecov.io"></a>
<a href="http://mit-license.org"><img src="http://img.shields.io/:license-mit-blue.svg" alt="License"></a>
<a href="http://semver.org/spec/v2.0.0.html"><img src="https://img.shields.io/badge/semver-2.0.0-blue.svg" alt="SemVer 2.0.0"></a></p>

<p>Latest stable version: 0.3.0</p>

<h2>
<a id="goals" class="anchor" href="#goals" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Goals</h2>

<ul>
<li>wellid should be easy to use and easy to learn</li>
<li>It is up to you, how much of the wellid-package you use, you can start with
small building blocks and use bigger concepts later</li>
<li>Extending wellid with your own Validators should be easy </li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>wellid works with PHP 5.6 and 7.0.</p>

<p>The package can be installed via composer:</p>

<p><code>composer require broeser/wellid</code></p>

<h2>
<a id="before-you-start" class="anchor" href="#before-you-start" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Before you start</h2>

<ul>
<li>All examples from this manual can be found in <a href="usage_examples.php">usage_examples.php</a>
in the same order as in the manual. If an example uses an additional class,
that class can be found in the examples/-directory.</li>
<li>
<strong>IMPORTANT NOTE:</strong> Never try to validate raw data! Sanitize your data first, 
then pass it to wellid. Recommended sanitization options are:

<ol>
<li>Let your framework handle sanitization</li>
<li>Use <a href="https://github.com/broeser/sanitor">Sanitor</a> (composer require broeser/sanitor)</li>
<li>Use PHP's filter_input() and filter_var() methods</li>
</ol>
</li>
</ul>

<h2>
<a id="using-wellid" class="anchor" href="#using-wellid" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using wellid</h2>

<h3>
<a id="simple-use-case-with-validatebool" class="anchor" href="#simple-use-case-with-validatebool" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Simple use case <em>with validateBool()</em>
</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * The value to validate</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>somethingentered<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * The validator that shall be used to validate it</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$maxLengthValidator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Wellid\Validator\</span><span class="pl-c1">MaxLength</span>(<span class="pl-c1">7</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * Validate the value and do something in case it is valid:</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">if</span>(<span class="pl-smi">$maxLengthValidator</span><span class="pl-k">-&gt;</span>validateBool(<span class="pl-smi">$value</span>)) {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>The given value <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$value</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> fits our requirements of a maximum length of 7 characters! YAY!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">} <span class="pl-k">else</span> {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>The given value <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$value</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> is totally invalid. :-(<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">}</span></pre></div>

<p>The simplest usage case is creating a new validator and using the 
<strong>validateBool()</strong>-method. It takes the value that shall be validated as parameter
and returns true on success and false on failure.</p>

<p>These are the validators supplied with wellid by default:</p>

<ul>
<li>Boolean</li>
<li>Date</li>
<li>Email</li>
<li>Filesize</li>
<li>FloatingPoint</li>
<li>IPAddress</li>
<li>Integer</li>
<li>MacAddress</li>
<li>Max</li>
<li>MaxLength</li>
<li>MIME</li>
<li>Min</li>
<li>MinLength</li>
<li>Password</li>
<li>URL</li>
</ul>

<h3>
<a id="error-handling-with-validate-and-validationresult" class="anchor" href="#error-handling-with-validate-and-validationresult" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error handling <em>with validate() and ValidationResult</em>
</h3>

<p>Sometimes it is important to know, <em>why</em> validation failed. If you need more than
boolean true/false, you can use the <strong>validate()</strong>-method of a validator of
your choice to get a <strong>ValidationResult</strong>-object. A ValidationResult includes 
an error message and error code if validation fails, you can use <strong>getCode()</strong> and
 <strong>getMessage()</strong> to retrieve them:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * The value to validate</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>somethingentered<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * The validator that shall be used to validate it</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$maxLengthValidator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Wellid\Validator\</span><span class="pl-c1">MaxLength</span>(<span class="pl-c1">7</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * Validate the value and get a ValidationResult-object</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$validationResult</span> <span class="pl-k">=</span> <span class="pl-smi">$maxLengthValidator</span><span class="pl-k">-&gt;</span>validate(<span class="pl-smi">$value</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">if</span>(<span class="pl-smi">$validationResult</span><span class="pl-k">-&gt;</span>hasPassed()) {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>The given value <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$value</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> fits our requirements of a maximum length of 7 characters! YAY!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">} <span class="pl-k">else</span> {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>The given value <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$value</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> is totally invalid. :-(<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Reason: <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$validationResult</span><span class="pl-k">-&gt;</span>getMessage()<span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> – Error code: <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$validationResult</span><span class="pl-k">-&gt;</span>getCode()<span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">}</span></pre></div>

<h3>
<a id="validationresultsets--a-collection-of-validationresults" class="anchor" href="#validationresultsets--a-collection-of-validationresults" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ValidationResultSets <em>– A collection of ValidationResults</em>
</h3>

<p>If you validate a value with several different validators, or if you validate a
lot of different values you might need a better way of handling the results:</p>

<p>You can combine several ValidationResults to form a ValidationResultSet. You can
<strong>add()</strong> a single ValidationResult to a ValidationResultSet or you can combine
two ValidationResultSets with <strong>addSet()</strong></p>

<p>ValidationResultSets can be count()-ed and iterated over with foreach(). </p>

<p><strong>hasErrors()</strong> is useful to check if there are any errors
in the ValidationResultSet, its counterpart is called <strong>hasPassed()</strong>. You can 
retrieve the <strong>firstError()</strong>-ValidationResult (if there is any), if everything
has passed the method will return null.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * The value to validate</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>somethingentered<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * The validator that shall be used to validate it</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$maxLengthValidator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Wellid\Validator\</span><span class="pl-c1">MaxLength</span>(<span class="pl-c1">7</span>);</span>
<span class="pl-s1"><span class="pl-smi">$minLengthValidator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Wellid\Validator\</span><span class="pl-c1">MinLength</span>(<span class="pl-c1">3</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$validationResultSet</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Wellid\</span><span class="pl-c1">ValidationResultSet</span>();</span>
<span class="pl-s1"><span class="pl-smi">$validationResultSet</span><span class="pl-k">-&gt;</span>add(<span class="pl-smi">$maxLengthValidator</span><span class="pl-k">-&gt;</span>validate(<span class="pl-smi">$value</span>));</span>
<span class="pl-s1"><span class="pl-smi">$validationResultSet</span><span class="pl-k">-&gt;</span>add(<span class="pl-smi">$minLengthValidator</span><span class="pl-k">-&gt;</span>validate(<span class="pl-smi">$value</span>));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">if</span>(<span class="pl-smi">$validationResultSet</span><span class="pl-k">-&gt;</span>hasPassed()) {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>The given value <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$value</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> fits our requirements of a maximum and minimum length! YAY!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">} <span class="pl-k">else</span> {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>The given value <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$value</span><span class="pl-k">.</span><span class="pl-s"><span class="pl-pds">'</span> is totally invalid. :-(<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">}</span></pre></div>

<h3>
<a id="validating-objects-with-validatabletrait-and-validatableinterface" class="anchor" href="#validating-objects-with-validatabletrait-and-validatableinterface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validating objects <em>with ValidatableTrait and ValidatableInterface</em>
</h3>

<p>If you want to create classes (as opposed to primitive data types) whose instances
are validateable by wellid, just implement the <strong>ValidatableInterface</strong> in your class
and use the <strong>ValidatableTrait</strong>. If you prefer abstract classes instead, (e.g.
if you want to override functionality from ValidatableTrait), extending
<strong>AbstractValidatable</strong> is the way to go. In either case, Make sure to implement
 a <strong>getValue()</strong> method to supply the validators with a primitive typed version
of your object's value. For a Money-class, for example, that might be a float.</p>

<p>You'll now be able to <strong>addValidators()</strong> to your 
object. You can validate your object with the <strong>validate()</strong> and <strong>validateBool()</strong>
methods. </p>

<p>Note that <strong>validate()</strong> returns a ValidationResultSet and not a ValidationResult
(see above).</p>

<p>The following example code uses three validators: 
The value shall be a floating point number. It shall be between 0 (zero) and 
830.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">AccountBalance</span> <span class="pl-k">implements</span> <span class="pl-c1">\Wellid\</span><span class="pl-e">ValidatableInterface</span> {</span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">\Wellid\ValidatableTrait</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@var</span> float</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">protected</span> <span class="pl-smi">$value</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-c1">__construct</span>() {</span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>addValidators(<span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">FloatingPoint</span>(), <span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">Min</span>(<span class="pl-c1">0</span>), <span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">Max</span>(<span class="pl-c1">830</span>));</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@param</span> float $val</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> \self</span></span>
<span class="pl-s1"><span class="pl-c">     */</span>    </span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">function</span> <span class="pl-en">createFromFloat</span>(<span class="pl-smi">$val</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$newInstance</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-k">self</span>();</span>
<span class="pl-s1">        <span class="pl-smi">$newInstance</span><span class="pl-k">-&gt;</span>setValue(<span class="pl-smi">$val</span>);</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$newInstance</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> float</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">getValue</span>() {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">value</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@param</span> float $val</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">setValue</span>(<span class="pl-smi">$val</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span><span class="pl-smi">value</span> <span class="pl-k">=</span> <span class="pl-smi">$val</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">foreach</span>(<span class="pl-c1">array</span>(<span class="pl-c1">57.3</span>, <span class="pl-k">-</span><span class="pl-c1">6</span>) <span class="pl-k">as</span> <span class="pl-smi">$v</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$yourBalance</span> <span class="pl-k">=</span> <span class="pl-c1">WellidUsageExamples\</span><span class="pl-c1">AccountBalance</span><span class="pl-k">::</span>createFromFloat(<span class="pl-smi">$v</span>);</span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$yourBalance</span><span class="pl-k">-&gt;</span>validate();</span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>hasErrors()) {</span>
<span class="pl-s1">        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Oh dear! Something invalid was used as my account balance!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Aha, that is why: <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>firstError()<span class="pl-k">-&gt;</span>getMessage()<span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<h3>
<a id="caching-validationresultsets-with-cacheablevalidatabletrait-and-cacheablevalidatableinterface" class="anchor" href="#caching-validationresultsets-with-cacheablevalidatabletrait-and-cacheablevalidatableinterface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Caching ValidationResultSets <em>with CacheableValidatableTrait and CacheableValidatableInterface</em>
</h3>

<p>If a lot of Validators are used in validating an object, caching might improve
performance. In the last chapter each call to validate() or validateBool()
starts validation anew. To add caching functionality use 
<strong>CacheableValidatableInterface</strong> instead of ValidatableInterface and 
<strong>CacheableValidatableTrait</strong> instead of ValidatableTrait. If you prefer an
abstract class over traits and interfaces, extend <strong>AbstractCacheableValidatable</strong>.
All cache-related functionality can be found in the \Wellid\Cache-namespace.</p>

<p>Like the cacheless variant, CacheableValidatable has to implement the 
getValue()-method.</p>

<p>Caching will be performed automatically.</p>

<p>If you want to disable caching for a particular instance of 
CacheableValidatableInterface, you can call <strong>disableValidationCache()</strong>. This
will also remove a potentially existing ValidationResultSet from the cache of
that instance.</p>

<p>While rarely useful, you can also force revalidation without disabling the cache.
Clear the current ValidationResultSet with <strong>clearValidationResult()</strong>, then use
validate() or validateBool() to get a new ValidationResultSet.</p>

<h3>
<a id="a-collection-of-validators--the-validatorholder" class="anchor" href="#a-collection-of-validators--the-validatorholder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>A collection of Validators <em>– The ValidatorHolder</em>
</h3>

<p>The way wellid is designed, you can always add validators directly to your data
objects. However it might become handy to store a collection of validators
separate from the data objects or even without having data objects.</p>

<p>You can use the <strong>ValidatorHolder</strong>-class directly, extend it by your own class,
or you can create a class that implements <strong>ValidatorHolderInterface</strong> and may
use the <strong>ValidatorHolderTrait</strong> to get some basic functionality.</p>

<p>Adding validators works the same as on data objects: You
can use addValidators() or <strong>addValidator()</strong> (for a single validator). Use 
<strong>getValidators()</strong> to retrieve an array of all assigned validators.</p>

<p>To validate a value with the ValidatorHolder, use the <strong>validateValue()</strong>-method. </p>

<p>The AccountBalance-example from above becomes much cleaner and easier to 
understand. </p>

<p>Example:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">AccountBalanceValidators</span> <span class="pl-k">extends</span> <span class="pl-c1">\Wellid\</span><span class="pl-e">ValidatorHolder</span> {</span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-c1">__construct</span>() {</span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>addValidators(<span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">FloatingPoint</span>(), <span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">Min</span>(<span class="pl-c1">0</span>), <span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">Max</span>(<span class="pl-c1">830</span>));</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$accountBalanceValidators</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">\WellidUsageExamples\</span><span class="pl-c1">AccountBalanceValidators</span>();</span>
<span class="pl-s1"><span class="pl-k">foreach</span>(<span class="pl-c1">array</span>(<span class="pl-c1">57.3</span>, <span class="pl-k">-</span><span class="pl-c1">6</span>) <span class="pl-k">as</span> <span class="pl-smi">$v</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$accountBalanceValidators</span><span class="pl-k">-&gt;</span>validateValue(<span class="pl-smi">$v</span>);</span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>hasErrors()) {</span>
<span class="pl-s1">        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Oh dear! Something invalid was used as my account balance!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Aha, that is why: <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>firstError()<span class="pl-k">-&gt;</span>getMessage()<span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<p>Of course you don't have to setup the validators in the constructor in your own 
project, but you can just call addValidator or addValidators from anywhere.</p>

<p>Please note, that there is currently no validateBoolValue()-method for
ValidatorHolders. If you need the boolean value you can use the syntax
<code>$validationResultAsBool = $accountBalanceValidators-&gt;validateValue($value)-&gt;hasPassed();</code></p>

<p>Another example shows, how to use ValidatorHolders with data objects. (Both 
used classes are the same as in the examples above):</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">/*</span></span>
<span class="pl-s1"><span class="pl-c"> * Example 3b: Using the ValidatorHolderTrait &amp; ValidatorHolderInterface with</span></span>
<span class="pl-s1"><span class="pl-c"> * data objects</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-smi">$accountBalanceValidators</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">\WellidUsageExamples\</span><span class="pl-c1">AccountBalanceValidators</span>();</span>
<span class="pl-s1"><span class="pl-k">foreach</span>(<span class="pl-c1">array</span>(<span class="pl-c1">57.3</span>, <span class="pl-k">-</span><span class="pl-c1">6</span>) <span class="pl-k">as</span> <span class="pl-smi">$v</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$yourBalance</span> <span class="pl-k">=</span> <span class="pl-c1">WellidUsageExamples\</span><span class="pl-c1">AccountBalance</span><span class="pl-k">::</span>createFromFloat(<span class="pl-smi">$v</span>);</span>
<span class="pl-s1">    <span class="pl-smi">$result</span> <span class="pl-k">=</span> <span class="pl-smi">$accountBalanceValidators</span><span class="pl-k">-&gt;</span>validateValue(<span class="pl-smi">$yourBalance</span><span class="pl-k">-&gt;</span>getValue());</span>
<span class="pl-s1">    <span class="pl-k">if</span>(<span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>hasErrors()) {</span>
<span class="pl-s1">        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Oh dear! Something invalid was used as my account balance!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">        <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Aha, that is why: <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$result</span><span class="pl-k">-&gt;</span>firstError()<span class="pl-k">-&gt;</span>getMessage()<span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<h3>
<a id="using-wellid-with-sanitor-with-sanitorbridgetrait-and-sanitorbridgeinterface" class="anchor" href="#using-wellid-with-sanitor-with-sanitorbridgetrait-and-sanitorbridgeinterface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using wellid with Sanitor <em>with SanitorBridgeTrait and SanitorBridgeInterface</em>
</h3>

<p><a href="https://github.com/broeser/sanitor">Sanitor</a> is a thin wrapper around PHP's 
sanitization functions (filter_var(), filter_input(), etc.). 
If you want to use Sanitor to sanitize input or arbitrary
values before validating them with wellid, there is a handy piece of code called
the <strong>SanitorBridgeTrait</strong> just for that.</p>

<p>Refer to Sanitor's README.md for more information.
These are the four basic steps necessary to integrate Sanitor and wellid</p>

<ol>
<li>Install the Sanitor package (composer require broeser/sanitor)</li>
<li>Substitute the ValidatableTrait and CacheableValidatableTraits with the 
<strong>SanitorBridgeTrait</strong> in all places.</li>
<li>Make sure that those classes implement <strong>SanitorBridgeInterface</strong>
</li>
<li>Make sure that those classes call $this-&gt;setSanitizer(...) somewhere
before validation (e. g. in the constructor) and set a fitting
sanitization filter (you can try FILTER_DEFAULT)</li>
</ol>

<p>SanitorBridge automatically uses caching. You don't have to clear the cache
when setting a new rawValue, this will be done automatically.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">SanitorWellidEmailExample</span> <span class="pl-k">implements</span> <span class="pl-c1">\Wellid\</span><span class="pl-e">SanitorBridgeInterface</span>, <span class="pl-c1">\Wellid\</span><span class="pl-e">ValidatableInterface</span> {</span>
<span class="pl-s1">    <span class="pl-k">use</span> <span class="pl-c1">\Wellid\SanitorBridgeTrait</span>, <span class="pl-c1">\Wellid\ValidatableTrait</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * Constructor</span></span>
<span class="pl-s1"><span class="pl-c">     * </span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@param</span> \Sanitor\Sanitizer $sanitizer</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-c1">__construct</span>(<span class="pl-c1">\Sanitor\</span><span class="pl-c1">Sanitizer</span> <span class="pl-smi">$sanitizer</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>setSanitizer(<span class="pl-c1">is_null</span>(<span class="pl-smi">$sanitizer</span>)?<span class="pl-k">new</span> <span class="pl-c1">\Sanitor\</span><span class="pl-c1">Sanitizer</span>(<span class="pl-c1">FILTER_SANITIZE_EMAIL</span>):<span class="pl-smi">$sanitizer</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$this</span><span class="pl-k">-&gt;</span>addValidator(<span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">Email</span>());</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$emailValidator</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">WellidUsageExamples\</span><span class="pl-c1">SanitorWellidEmailExample</span>(<span class="pl-k">new</span> <span class="pl-c1">\Sanitor\</span><span class="pl-c1">Sanitizer</span>(<span class="pl-c1">FILTER_SANITIZE_EMAIL</span>));</span>
<span class="pl-s1"><span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>setRawValue(<span class="pl-s"><span class="pl-pds">'</span>mail@benedict\roeser.de<span class="pl-pds">'</span></span>); <span class="pl-c">// because the value will be sanitized before validation, this will actually pass! More information in the "65{"-example below</span></span>
<span class="pl-s1"><span class="pl-k">if</span>(<span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>validate()<span class="pl-k">-&gt;</span>hasErrors()) {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Why! Oh why! Errors everywhere!<span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">}</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-c">// values can also be optained from INPUT_GET, INPUT_POST, etc.:</span></span>
<span class="pl-s1"><span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>rawValueFromInput(<span class="pl-c1">INPUT_REQUEST</span>, <span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1"><span class="pl-k">if</span>(<span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>validate()<span class="pl-k">-&gt;</span>hasPassed()) {</span>
<span class="pl-s1">    <span class="pl-c1">print</span>(<span class="pl-s"><span class="pl-pds">'</span>Nice, this input has been valid: <span class="pl-pds">'</span></span><span class="pl-k">.</span><span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>getValue()<span class="pl-k">.</span><span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">}</span></pre></div>

<p>Imagine you are expecting an integer as value, but the user enters <code>65{</code> instead.
Depending on your business logic, two different cases are possible:</p>

<ol>
<li>Ignore the { and assume 65, continue working with 65. Optionally notify the
user of this – this makes sense if there is an undo anyway and you don't
want to annoy your users with error messages.</li>
<li>Return an error message and ask for the value again – this makes sense if
the user is not expected to notice/fix the mistake, or if valid data is
more important than user experience</li>
</ol>

<p>The first case is the default setting.</p>

<p>For the second case, just add a <strong>SanitorMatch</strong>-Validator to your object before
starting validation. The SanitorMatch-Validator expects the validatable object 
itself as parameter on construction. The Validator uses 
"The given value contains illegal characters" as error message, if validation
fails.</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>addValidator(<span class="pl-k">new</span> <span class="pl-c1">\Wellid\Validator\</span><span class="pl-c1">SanitorMatch</span>(<span class="pl-smi">$emailValidator</span>));</span></pre></div>

<p>Luckily there is a shorter way to accomplish the same with the method
<strong>addSanitorMatchValidator()</strong>:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$emailValidator</span><span class="pl-k">-&gt;</span>addSanitorMatchValidator();</span></pre></div>

<h3>
<a id="exceptions" class="anchor" href="#exceptions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exceptions</h3>

<p>Feel free to use the Exception-classes supplied with wellid in any validation
context you want to.</p>

<ul>
<li>DataFormat</li>
<li>DataType</li>
<li>NotFound</li>
<li>FileNotFound</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing?</h2>

<p>Yes, please!</p>

<p>See <a href="https://github.com/broeser/wellid/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a> for details and/or open an issue with your questions.</p>

<p>Please note that this project is released with a <a href="https://github.com/broeser/wellid/blob/master/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. 
By participating in this project you agree to abide by its terms.</p>

<h2>
<a id="wellid-1" class="anchor" href="#wellid-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>wellid?</h2>

<p>Yes, it is a pun on well and valid.</p>
        </section>

        <footer>
          wellid is maintained by <a href="https://github.com/broeser">broeser</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
